<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>My Store</title>
<style>
  /* الخط العام */
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
  body {
    font-family: 'Inter', sans-serif;
    margin: 0;
    background: #e6f0ff;
    display: flex;
    min-height: 100vh;
    color: #333;
  }
  /* حاوية المنتجات تأخذ المساحة المتبقية */
  #productsContainer {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    padding: 20px;
    margin-right: 320px; /* مساحة للسلة */
    box-sizing: border-box;
  }
  /* صندوق منتج */
  .product {
    background: #dbe9ff;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    transition: background-color 0.3s ease, transform 0.2s ease;
    cursor: pointer;
  }
  .product:hover {
    background-color: #a3c4ff;
    transform: translateY(-5px);
  }
  .product h3 {
    margin-top: 0;
    margin-bottom: 8px;
    font-weight: 600;
  }
  .product p {
    margin: 4px 0;
    font-size: 0.9rem;
  }
  /* زر إضافة للسلة */
  .add-btn {
    margin-top: 10px;
    background: #0047b3;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 5px;
    font-weight: 600;
    cursor: pointer;
    width: 100%;
    transition: background-color 0.3s ease;
  }
  .add-btn:hover {
    background: #002e7a;
  }
  /* الهيدر */
  header {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 60px;
    background: #0047b3;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 20px;
    z-index: 20;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  }
  header h1 {
    margin: 0;
    font-weight: 700;
  }
  #langToggle {
    background: white;
    color: #0047b3;
    border: none;
    padding: 6px 14px;
    border-radius: 20px;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #langToggle:hover {
    background-color: #cce0ff;
  }
  /* سلة المشتريات */
  #cart {
    width: 300px;
    position: fixed;
    top: 70px;
    right: 10px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.15);
    padding: 20px;
    max-height: calc(100vh - 90px);
    overflow-y: auto;
    z-index: 15;
  }
  #cart h2 {
    margin-top: 0;
    font-weight: 700;
    text-align: center;
  }
  /* أيقونة سلة المشتريات مع عداد */
  #cartIconContainer {
    position: fixed;
    top: 15px;
    right: 15px;
    cursor: pointer;
    z-index: 30;
  }
  #cartIcon {
    font-size: 28px;
    color: #0047b3;
    position: relative;
  }
  #cartCount {
    position: absolute;
    top: -8px;
    right: -10px;
    background: #ffcc00;
    color: #222;
    font-weight: 700;
    font-size: 14px;
    border-radius: 50%;
    padding: 3px 7px;
    min-width: 22px;
    text-align: center;
    box-shadow: 0 0 4px rgba(0,0,0,0.2);
  }
  /* عناصر داخل السلة */
  .cart-item {
    border-bottom: 1px solid #ddd;
    padding: 10px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .cart-item:last-child {
    border-bottom: none;
  }
  .cart-item-name {
    font-weight: 600;
    max-width: 140px;
    word-break: break-word;
  }
  .cart-item-qty {
    margin: 0 10px;
    font-size: 1rem;
  }
  .cart-item-price {
    font-weight: 600;
  }
  .remove-btn {
    background: transparent;
    border: none;
    color: #d11a2a;
    font-weight: 700;
    cursor: pointer;
    font-size: 18px;
  }
  /* مجموع السعر */
  #totalPrice {
    margin-top: 15px;
    text-align: center;
    font-size: 1.3rem;
    font-weight: 700;
    color: #d11a2a;
    background: #ffe6e6;
    padding: 8px;
    border-radius: 6px;
    box-shadow: inset 0 0 6px rgba(209,26,42,0.3);
  }

  /* استجابة */
  @media (max-width: 900px) {
    #productsContainer {
      grid-template-columns: repeat(2, 1fr);
      margin-right: 0;
      padding: 20px 10px;
    }
    #cart {
      position: relative;
      width: 100%;
      max-height: none;
      margin: 10px auto 20px;
      box-shadow: none;
      border-radius: 0;
      padding: 10px;
    }
    #cartIconContainer {
      display: none;
    }
  }
  @media (max-width: 550px) {
    #productsContainer {
      grid-template-columns: 1fr;
      padding: 10px;
    }
  }
</style>
</head>
<body>

<header>
  <h1 id="title">My Store</h1>
  <button id="langToggle">عربي</button>
</header>

<!-- أيقونة السلة مع عدد المنتجات -->
<div id="cartIconContainer" title="Shopping Cart">
  <span id="cartIcon">🛒</span>
  <span id="cartCount" style="display:none;">0</span>
</div>

<!-- قائمة المنتجات -->
<div id="productsContainer" style="margin-top: 70px;">
  <!-- المنتجات تظهر هنا -->
</div>

<!-- سلة المشتريات -->
<aside id="cart" aria-label="Shopping Cart">
  <h2>Shopping Cart</h2>
  <div id="cartItems">
    <p>Your cart is empty.</p>
  </div>
  <div id="totalPrice">Total: $0</div>
</aside>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  // إعداد Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCcWgFDzs95TbVU7v5h_5O0lNzZvBlL90o",
    authDomain: "baganiza-66bf0.firebaseapp.com",
    projectId: "baganiza-66bf0",
    storageBucket: "baganiza-66bf0.firebasestorage.app",
    messagingSenderId: "1016966032123",
    appId: "1:1016966032123:web:fbffd397c7d8494fa79e5e"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // اللغة الحالية
  let currentLang = 'en';

  // DOM عناصر
  const productsContainer = document.getElementById('productsContainer');
  const langToggle = document.getElementById('langToggle');
  const title = document.getElementById('title');
  const cart = document.getElementById('cart');
  const cartItemsContainer = document.getElementById('cartItems');
  const totalPriceEl = document.getElementById('totalPrice');
  const cartIconContainer = document.getElementById('cartIconContainer');
  const cartCount = document.getElementById('cartCount');

  // حالة السلة - تخزين المنتجات المضافة
  let cartItems = {};

  // تبديل اللغة
  langToggle.addEventListener('click', () => {
    currentLang = currentLang === 'en' ? 'ar' : 'en';
    if(currentLang === 'ar'){
      title.textContent = 'متجري';
      langToggle.textContent = 'English';
      cart.querySelector('h2').textContent = 'عربة التسوق';
      totalPriceEl.textContent = `الإجمالي: $${calculateTotal()}`;
      document.body.dir = 'rtl';
      cartItemsContainer.querySelectorAll('.cart-item-name').forEach(el => el.style.textAlign = 'right');
    } else {
      title.textContent = 'My Store';
      langToggle.textContent = 'عربي';
      cart.querySelector('h2').textContent = 'Shopping Cart';
      totalPriceEl.textContent = `Total: $${calculateTotal()}`;
      document.body.dir = 'ltr';
      cartItemsContainer.querySelectorAll('.cart-item-name').forEach(el => el.style.textAlign = 'left');
    }
    loadProducts();
    renderCart();
  });

  // تحميل وعرض المنتجات
  function loadProducts(){
    productsContainer.innerHTML = 'Loading products...';
    db.collection('products').get().then(snapshot => {
      productsContainer.innerHTML = '';
      if(snapshot.empty){
        productsContainer.textContent = currentLang === 'ar' ? 'لا توجد منتجات.' : 'No products found.';
        return;
      }

      // تجميع المنتجات بنفس الاسم (لوضعها جنب بعض)
      let grouped = {};
      snapshot.forEach(doc => {
        const p = doc.data();
        const key = p.name.trim().toLowerCase();
        if(!grouped[key]) grouped[key] = [];
        grouped[key].push({...p, id: doc.id});
      });

      // نعرض المنتجات مجمعة
      for(const key in grouped){
        grouped[key].forEach(product => {
          const productDiv = document.createElement('div');
          productDiv.className = 'product';
          productDiv.innerHTML = `
            <h3>${product.name}</h3>
            <p><strong>${currentLang === 'ar' ? 'السعر' : 'Price'}:</strong> $${product.price}</p>
            <p>${product.description}</p>
            <button class="add-btn">${currentLang === 'ar' ? 'أضف للسلة' : 'Add to Cart'}</button>
          `;
          // إضافة حدث زر الإضافة
          productDiv.querySelector('button').addEventListener('click', () => {
            addToCart(product);
          });
          productsContainer.appendChild(productDiv);
        });
      }
    });
  }

  // إضافة منتج للسلة
  function addToCart(product){
    if(cartItems[product.id]){
      cartItems[product.id].qty++;
    } else {
      cartItems[product.id] = {...product, qty: 1};
    }
    renderCart();
  }

  // إزالة منتج من السلة
  function removeFromCart(id){
    delete cartItems[id];
    renderCart();
  }

  // حساب المجموع الكلي
  function calculateTotal(){
    let total = 0;
    for(const id in cartItems){
      total += cartItems[id].price * cartItems[id].qty;
    }
    return total.toFixed(2);
  }

  // تحديث عرض السلة
  function renderCart(){
    cartItemsContainer.innerHTML = '';
    const items = Object.values(cartItems);
    if(items.length === 0){
      cartItemsContainer.innerHTML = `<p>${currentLang === 'ar' ? 'سلة المشتريات فارغة.' : 'Your cart is empty.'}</p>`;
      cartCount.style.display = 'none';
    } else {
      items.forEach(item => {
        const div = document.createElement('div');
        div.className = 'cart-item';
        div.innerHTML = `
          <span class="cart-item-name">${item.name}</span>
          <span class="cart-item-qty">x${item.qty}</span>
          <span class="cart-item-price">$${(item.price * item.qty).toFixed(2)}</span>
          <button class="remove-btn" title="${currentLang === 'ar' ? 'إزالة' : 'Remove'}">&times;</button>
        `;
        div.querySelector('button').addEventListener('click', () => removeFromCart(item.id));
        cartItemsContainer.appendChild(div);
      });
      cartCount.style.display = 'inline-block';
      cartCount.textContent = items.length;
    }
    totalPriceEl.textContent = currentLang === 'ar' ? `الإجمالي: $${calculateTotal()}` : `Total: $${calculateTotal()}`;
  }

  // إظهار / إخفاء السلة عند الضغط على الأيقونة
  let cartVisible = true;
  cartIconContainer.addEventListener('click', () => {
    cartVisible = !cartVisible;
    cart.style.display = cartVisible ? 'block' : 'none';
  });

  // تحميل المنتجات أول مرة
  loadProducts();
  renderCart();
</script>

</body>
</html>
