<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Store</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      background: #e6f0ff;
      color: #333;
      display: flex;
      min-height: 100vh;
      direction: ltr;
    }

    /* Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© */
    .main-container {
      flex: 1;
      margin-right: 320px; /* Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø³Ù„Ø© */
      padding: 90px 20px 20px 20px;
      box-sizing: border-box;
    }

    header {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 60px;
      background: #0047b3;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      z-index: 20;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }

    header h1 {
      margin: 0;
      font-weight: 700;
      font-size: 1.6rem;
    }

    #langToggle {
      background: white;
      color: #0047b3;
      border: none;
      padding: 6px 14px;
      border-radius: 20px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    #langToggle:hover {
      background-color: #cce0ff;
    }

    /* Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙ†ÙŠÙ */
    #searchFilter {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    #searchInput {
      flex: 1;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
      outline-color: #0047b3;
    }
    #categorySelect {
      width: 160px;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
      outline-color: #0047b3;
      background: white;
      cursor: pointer;
    }

    /* Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
    #productsContainer {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
    }

    .product {
      background: #dbe9ff;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
      transition: background-color 0.3s ease, transform 0.2s ease;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .product:hover {
      background-color: #a3c4ff;
      transform: translateY(-5px);
    }
    .product h3 {
      margin-top: 0;
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 1.1rem;
    }
    .product p {
      margin: 4px 0;
      font-size: 0.9rem;
      flex-grow: 1;
    }
    .add-btn {
      margin-top: 10px;
      background: #0047b3;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      transition: background-color 0.3s ease;
      align-self: center;
    }
    .add-btn:hover {
      background: #002e7a;
    }

    /* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø³Ù„Ø© ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª */
    #cartIconContainer {
      position: fixed;
      top: 15px;
      right: 15px;
      cursor: pointer;
      z-index: 30;
    }
    #cartIcon {
      font-size: 28px;
      color: #0047b3;
      position: relative;
    }
    #cartCount {
      position: absolute;
      top: -8px;
      right: -10px;
      background: #ffcc00;
      color: #222;
      font-weight: 700;
      font-size: 14px;
      border-radius: 50%;
      padding: 3px 7px;
      min-width: 22px;
      text-align: center;
      box-shadow: 0 0 4px rgba(0,0,0,0.2);
      display: none;
    }

    /* Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª */
    #cart {
      width: 300px;
      position: fixed;
      top: 70px;
      right: 10px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.15);
      padding: 20px;
      max-height: calc(100vh - 90px);
      overflow-y: auto;
      z-index: 15;
      display: block;
    }
    #cart h2 {
      margin-top: 0;
      font-weight: 700;
      text-align: center;
      font-size: 1.4rem;
      border-bottom: 2px solid #0047b3;
      padding-bottom: 8px;
      margin-bottom: 15px;
    }
    .cart-item {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .cart-item:last-child {
      border-bottom: none;
    }
    .cart-item-name {
      font-weight: 600;
      max-width: 140px;
      word-break: break-word;
    }
    .cart-item-qty {
      margin: 0 10px;
      font-size: 1rem;
    }
    .cart-item-price {
      font-weight: 600;
    }
    .remove-btn {
      background: transparent;
      border: none;
      color: #d11a2a;
      font-weight: 700;
      cursor: pointer;
      font-size: 18px;
    }
    #totalPrice {
      margin-top: 15px;
      text-align: center;
      font-size: 1.3rem;
      font-weight: 700;
      color: #d11a2a;
      background: #ffe6e6;
      padding: 8px;
      border-radius: 6px;
      box-shadow: inset 0 0 6px rgba(209,26,42,0.3);
    }

    /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯ÙØ¹ */
    #paymentSection {
      margin-top: 20px;
      border-top: 2px solid #0047b3;
      padding-top: 15px;
      font-size: 0.95rem;
    }
    #paymentSection h3 {
      margin: 0 0 10px 0;
      font-weight: 700;
      color: #0047b3;
      text-align: center;
    }
    .payment-option {
      margin-bottom: 10px;
      cursor: pointer;
      display: flex;
      align-items: center;
    }
    .payment-option input[type="radio"] {
      margin-right: 8px;
      cursor: pointer;
    }
    .payment-option label {
      cursor: pointer;
      user-select: none;
    }

    /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© */
    @media (max-width: 900px) {
      .main-container {
        margin-right: 0;
        padding: 80px 15px 15px 15px;
      }
      #productsContainer {
        grid-template-columns: repeat(2, 1fr);
      }
      #cart {
        position: relative;
        width: 100%;
        max-height: none;
        margin: 10px auto 20px;
        box-shadow: none;
        border-radius: 0;
        padding: 10px;
      }
      #cartIconContainer {
        display: none;
      }
    }
    @media (max-width: 550px) {
      #productsContainer {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>

  <header>
    <h1 id="title">My Store</h1>
    <button id="langToggle">Ø¹Ø±Ø¨ÙŠ</button>
  </header>

  <div class="main-container">
    <div id="searchFilter">
      <input type="text" id="searchInput" placeholder="Search products..." />
      <select id="categorySelect">
        <option value="">All Categories</option>
        <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
      </select>
    </div>
    <div id="productsContainer">
      <!-- Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
    </div>
  </div>

  <div id="cartIconContainer" title="Shopping Cart">
    <span id="cartIcon">ğŸ›’</span>
    <span id="cartCount"></span>
  </div>

  <aside id="cart" aria-label="Shopping Cart">
    <h2>Shopping Cart</h2>
    <div id="cartItems"></div>
    <div id="totalPrice">Total: $0.00</div>

    <section id="paymentSection">
      <h3>Choose Payment Method</h3>
      <div class="payment-option">
        <input type="radio" id="payCash" name="payment" value="cash" checked />
        <label for="payCash">Cash on Delivery</label>
      </div>
      <div class="payment-option">
        <input type="radio" id="payBank" name="payment" value="bank" />
        <label for="payBank">Bank Transfer</label>
      </div>
      <div class="payment-option">
        <input type="radio" id="payStc" name="payment" value="stc" />
        <label for="payStc">STC Pay</label>
      </div>
      <div class="payment-option">
        <input type="radio" id="payPaypal" name="payment" value="paypal" />
        <label for="payPaypal">PayPal</label>
      </div>
      <div class="payment-option">
        <input type="radio" id="payCard" name="payment" value="card" />
        <label for="payCard">Credit Card</label>
      </div>
    </section>
  </aside>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCcWgFDzs95TbVU7v5h_5O0lNzZvBlL90o",
      authDomain: "baganiza-66bf0.firebaseapp.com",
      projectId: "baganiza-66bf0",
      storageBucket: "baganiza-66bf0.firebasestorage.app",
      messagingSenderId: "1016966032123",
      appId: "1:1016966032123:web:fbffd397c7d8494fa79e5e"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let currentLang = 'en';

    const productsContainer = document.getElementById('productsContainer');
    const langToggle = document.getElementById('langToggle');
    const title = document.getElementById('title');

    const searchInput = document.getElementById('searchInput');
    const categorySelect = document.getElementById('categorySelect');

    const cart = document.getElementById('cart');
    const cartItemsContainer = document.getElementById('cartItems');
    const totalPriceEl = document.getElementById('totalPrice');
    const cartIconContainer = document.getElementById('cartIconContainer');
    const cartCount = document.getElementById('cartCount');

    let cartItems = {};
    let allProducts = [];
    let categories = new Set();

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Firebase
    function loadProducts() {
      productsContainer.innerHTML = 'Loading products...';
      db.collection('products').get().then(snapshot => {
        if (snapshot.empty) {
          productsContainer.textContent = currentLang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª.' : 'No products found.';
          return;
        }
        allProducts = [];
        categories.clear();
        snapshot.forEach(doc => {
          const product = doc.data();
          product.id = doc.id;
          allProducts.push(product);
          if(product.category) categories.add(product.category);
        });
        fillCategories();
        renderProducts();
      });
    }

    // ØªØ¹Ø¨Ø¦Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
    function fillCategories(){
      categorySelect.innerHTML = `<option value="">${currentLang === 'ar' ? 'ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª' : 'All Categories'}</option>`;
      [...categories].sort().forEach(cat => {
        categorySelect.innerHTML += `<option value="${cat}">${cat}</option>`;
      });
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¹ ØªØ±ØªÙŠØ¨ ÙˆØªØ¬Ù…ÙŠØ¹
    function renderProducts(){
      productsContainer.innerHTML = '';

      // ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙ†ÙŠÙ
      const searchText = searchInput.value.trim().toLowerCase();
      const selectedCategory = categorySelect.value;

      // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù…
      let grouped = {};
      allProducts.forEach(p => {
        // ØªØ­Ù‚Ù‚ Ù…Ù† ØªØµÙÙŠØ© Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙ†ÙŠÙ
        if(searchText && !p.name.toLowerCase().includes(searchText)) return;
        if(selectedCategory && p.category !== selectedCategory) return;

        const key = p.name.trim().toLowerCase();
        if(!grouped[key]) grouped[key] = [];
        grouped[key].push(p);
      });

      if(Object.keys(grouped).length === 0){
        productsContainer.textContent = currentLang === 'ar' ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©.' : 'No matching products.';
        return;
      }

      for (const key in grouped) {
        grouped[key].forEach(product => {
          const productDiv = document.createElement('div');
          productDiv.className = 'product';
          productDiv.innerHTML = `
            <h3>${product.name}</h3>
            <p><strong>${currentLang === 'ar' ? 'Ø§Ù„Ø³Ø¹Ø±' : 'Price'}:</strong> $${product.price}</p>
            <p>${product.description}</p>
            <button class="add-btn">${currentLang === 'ar' ? 'Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©' : 'Add to Cart'}</button>
          `;
          productDiv.querySelector('button').addEventListener('click', () => addToCart(product));
          productsContainer.appendChild(productDiv);
        });
      }
    }

    // Ø£Ø¶Ù Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø©
    function addToCart(product){
      if(cartItems[product.id]){
        cartItems[product.id].qty++;
      } else {
        cartItems[product.id] = {...product, qty: 1};
      }
      renderCart();
    }

    // Ø¥Ø²Ø§Ù„Ø© Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø©
    function removeFromCart(id){
      delete cartItems[id];
      renderCart();
    }

    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ
    function calculateTotal(){
      let total = 0;
      for(const id in cartItems){
        total += cartItems[id].price * cartItems[id].qty;
      }
      return total.toFixed(2);
    }

    // Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³Ù„Ø©
    function renderCart(){
      cartItemsContainer.innerHTML = '';
      const items = Object.values(cartItems);
      if(items.length === 0){
        cartItemsContainer.innerHTML = `<p>${currentLang === 'ar' ? 'Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª ÙØ§Ø±ØºØ©.' : 'Your cart is empty.'}</p>`;
        cartCount.style.display = 'none';
      } else {
        items.forEach(item => {
          const div = document.createElement('div');
          div.className = 'cart-item';
          div.innerHTML = `
            <span class="cart-item-name">${item.name}</span>
            <span class="cart-item-qty">x${item.qty}</span>
            <span class="cart-item-price">$${(item.price * item.qty).toFixed(2)}</span>
            <button class="remove-btn" title="${currentLang === 'ar' ? 'Ø¥Ø²Ø§Ù„Ø©' : 'Remove'}">&times;</button>
          `;
          div.querySelector('button').addEventListener('click', () => removeFromCart(item.id));
          cartItemsContainer.appendChild(div);
        });
        cartCount.style.display = 'inline-block';
        cartCount.textContent = items.length;
      }
      totalPriceEl.textContent = currentLang === 'ar' ? `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: $${calculateTotal()}` : `Total: $${calculateTotal()}`;
    }

    // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© Ù…Ø¹ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ø§ØªØ¬Ø§Ù‡
    langToggle.addEventListener('click', () => {
      currentLang = currentLang === 'en' ? 'ar' : 'en';

      if(currentLang === 'ar'){
        title.textContent = 'Ù…ØªØ¬Ø±ÙŠ';
        langToggle.textContent = 'English';
        cart.querySelector('h2').textContent = 'Ø¹Ø±Ø¨Ø© Ø§Ù„ØªØ³ÙˆÙ‚';
        totalPriceEl.textContent = `Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: $${calculateTotal()}`;
        searchInput.placeholder = 'Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...';
        fillCategories();
        cart.style.direction = 'rtl';
        document.body.dir = 'rtl';
        cartItemsContainer.querySelectorAll('.cart-item-name').forEach(el => el.style.textAlign = 'right');
      } else {
        title.textContent = 'My Store';
        langToggle.textContent = 'Ø¹Ø±Ø¨ÙŠ';
        cart.querySelector('h2').textContent = 'Shopping Cart';
        totalPriceEl.textContent = `Total: $${calculateTotal()}`;
        searchInput.placeholder = 'Search products...';
        fillCategories();
        cart.style.direction = 'ltr';
        document.body.dir = 'ltr';
        cartItemsContainer.querySelectorAll('.cart-item-name').forEach(el => el.style.textAlign = 'left');
      }
      renderProducts();
      renderCart();
    });

    // Ø§Ù„ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙ†ÙŠÙ
    searchInput.addEventListener('input', renderProducts);
    categorySelect.addEventListener('change', renderProducts);

    // Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø³Ù„Ø© ÙŠØ®ÙÙŠ/ÙŠØ¸Ù‡Ø± Ø§Ù„Ø³Ù„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    cartIconContainer.addEventListener('click', () => {
      if(cart.style.display === 'none' || cart.style.display === ''){
        cart.style.display = 'block';
      } else {
        cart.style.display = 'none';
      }
    });

    // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª
    loadProducts();

  </script>
</body>
</html>
