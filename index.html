<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>My Store</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f5f7fa; }
  header { display: flex; justify-content: space-between; align-items: center; padding: 15px; background-color: #232f3e; color: white; flex-wrap: wrap; }
  h1 { margin: 0; font-size: 20px; }
  button, select, input { padding: 6px; margin: 5px; }
  #productsContainer { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; padding: 15px; }
  .product { background: white; border-radius: 8px; padding: 10px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); transition: transform 0.2s, box-shadow 0.2s; }
  .product:hover { transform: scale(1.03); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
  .product img { max-width: 100%; height: 150px; object-fit: cover; }
  .product h3 { font-size: 16px; margin: 10px 0; }
  .cart-icon { position: relative; cursor: pointer; }
  .cart-count { position: absolute; top: -5px; right: -10px; background: yellow; color: black; font-size: 12px; padding: 2px 6px; border-radius: 50%; }
  #cartSidebar { position: fixed; right: 0; top: 0; width: 300px; height: 100%; background: white; box-shadow: -2px 0 5px rgba(0,0,0,0.2); transform: translateX(100%); transition: transform 0.3s; padding: 15px; overflow-y: auto; }
  #cartSidebar.open { transform: translateX(0); }
  #cartTotal { font-size: 18px; font-weight: bold; color: red; }
  /* Modal Styles */
  .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
  .modal-content { background: white; margin: 10% auto; padding: 20px; border-radius: 8px; width: 90%; max-width: 400px; }
</style>
</head>
<body>

<header>
  <h1 id="title">My Store</h1>
  <div>
    <input type="text" id="searchInput" placeholder="Search products...">
    <select id="categoryFilter"><option value="">All Categories</option></select>
    <button id="langToggle">ÿπÿ±ÿ®Ÿä</button>
    <span class="cart-icon" id="cartIcon">üõí<span class="cart-count" id="cartCount">0</span></span>
  </div>
</header>

<div id="productsContainer"></div>

<div id="cartSidebar">
  <h2>Shopping Cart</h2>
  <ul id="cartItems"></ul>
  <p id="cartTotal">Total: $0.00</p>
  <button id="checkoutBtn">Checkout</button>
</div>

<!-- Checkout Modal -->
<div id="checkoutModal" class="modal">
  <div class="modal-content">
    <h3>Choose Payment Method</h3>
    <select id="paymentMethod">
      <option value="">-- Select --</option>
      <option value="cash">Cash</option>
      <option value="bank">Bank Transfer</option>
      <option value="stcpay">STC Pay</option>
      <option value="paypal">PayPal</option>
      <option value="card">Credit Card</option>
    </select>
    <div id="paymentDetails"></div>
    <button id="confirmPaymentBtn">Confirm</button>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCcWgFDzs95TbVU7v5h_5O0lNzZvBlL90o",
    authDomain: "baganiza-66bf0.firebaseapp.com",
    projectId: "baganiza-66bf0",
    storageBucket: "baganiza-66bf0.firebasestorage.app",
    messagingSenderId: "1016966032123",
    appId: "1:1016966032123:web:fbffd397c7d8494fa79e5e"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  let currentLang = 'en';
  let cart = [];

  const productsContainer = document.getElementById('productsContainer');
  const langToggle = document.getElementById('langToggle');
  const title = document.getElementById('title');
  const searchInput = document.getElementById('searchInput');
  const categoryFilter = document.getElementById('categoryFilter');
  const cartIcon = document.getElementById('cartIcon');
  const cartSidebar = document.getElementById('cartSidebar');
  const cartItems = document.getElementById('cartItems');
  const cartTotal = document.getElementById('cartTotal');
  const cartCount = document.getElementById('cartCount');
  const checkoutBtn = document.getElementById('checkoutBtn');
  const checkoutModal = document.getElementById('checkoutModal');
  const paymentMethod = document.getElementById('paymentMethod');
  const paymentDetails = document.getElementById('paymentDetails');
  const confirmPaymentBtn = document.getElementById('confirmPaymentBtn');

  langToggle.addEventListener('click', () => {
    currentLang = currentLang === 'en' ? 'ar' : 'en';
    if(currentLang === 'ar'){
      title.textContent = 'ŸÖÿ™ÿ¨ÿ±Ÿä';
      langToggle.textContent = 'English';
      document.body.dir = 'rtl';
    } else {
      title.textContent = 'My Store';
      langToggle.textContent = 'ÿπÿ±ÿ®Ÿä';
      document.body.dir = 'ltr';
    }
    loadProducts();
  });

  cartIcon.addEventListener('click', () => {
    cartSidebar.classList.toggle('open');
  });

  checkoutBtn.addEventListener('click', () => {
    checkoutModal.style.display = 'block';
  });

  confirmPaymentBtn.addEventListener('click', async () => {
    const method = paymentMethod.value;
    if(!method) { alert('Please select payment method'); return; }
    const order = { items: cart, total: getCartTotal(), paymentMethod: method, date: new Date() };
    await db.collection('orders').add(order);
    alert('Order saved! (Email sending requires backend)');
    cart = [];
    updateCartUI();
    checkoutModal.style.display = 'none';
  });

  paymentMethod.addEventListener('change', () => {
    let html = '';
    if(paymentMethod.value === 'bank'){
      html = '<input type="text" placeholder="Bank Account Number">';
    } else if(paymentMethod.value === 'stcpay'){
      html = '<input type="text" placeholder="STC Pay Number">';
    } else if(paymentMethod.value === 'paypal'){
      html = '<input type="email" placeholder="PayPal Email">';
    } else if(paymentMethod.value === 'card'){
      html = '<input type="text" placeholder="Card Number"><input type="text" placeholder="Expiry"><input type="text" placeholder="CVV">';
    }
    paymentDetails.innerHTML = html;
  });

  function loadProducts(){
    productsContainer.innerHTML = 'Loading products...';
    db.collection('products').get().then(snapshot => {
      productsContainer.innerHTML = '';
      let categories = new Set();
      snapshot.forEach(doc => {
        const product = doc.data();
        categories.add(product.category || 'Other');
        const productDiv = document.createElement('div');
        productDiv.className = 'product';
        productDiv.innerHTML = `
          <img src="${product.image || 'https://via.placeholder.com/150'}" alt="${product.name}">
          <h3>${product.name}</h3>
          <p><strong>${currentLang === 'ar' ? 'ÿßŸÑÿ≥ÿπÿ±' : 'Price'}:</strong> $${product.price}</p>
          <p>${product.description}</p>
          <button onclick="addToCart('${doc.id}', '${product.name}', ${product.price})">${currentLang === 'ar' ? 'ÿ£ÿ∂ŸÅ ŸÑŸÑÿ≥ŸÑÿ©' : 'Add to Cart'}</button>
        `;
        productsContainer.appendChild(productDiv);
      });
      categoryFilter.innerHTML = '<option value="">All Categories</option>' + Array.from(categories).map(c => `<option value="${c}">${c}</option>`).join('');
    });
  }

  function addToCart(id, name, price){
    cart.push({id, name, price});
    updateCartUI();
  }

  function updateCartUI(){
    cartItems.innerHTML = '';
    cart.forEach(item => {
      const li = document.createElement('li');
      li.textContent = `${item.name} - $${item.price}`;
      cartItems.appendChild(li);
    });
    cartTotal.textContent = `Total: $${getCartTotal()}`;
    cartCount.textContent = cart.length;
  }

  function getCartTotal(){
    return cart.reduce((sum, item) => sum + item.price, 0).toFixed(2);
  }

  searchInput.addEventListener('input', filterProducts);
  categoryFilter.addEventListener('change', filterProducts);

  function filterProducts(){
    const searchValue = searchInput.value.toLowerCase();
    const categoryValue = categoryFilter.value;
    const products = document.querySelectorAll('.product');
    products.forEach(p => {
      const name = p.querySelector('h3').textContent.toLowerCase();
      const category = p.getAttribute('data-category');
      if(name.includes(searchValue) && (!categoryValue || category === categoryValue)){
        p.style.display = '';
      } else {
        p.style.display = 'none';
      }
    });
  }

  loadProducts();
</script>

</body>
</html>
