<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin - BAGANIZA Store</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #f5f7fa, #c3cfe2);
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
    color: #333;
  }
  form {
    max-width: 500px;
    margin: auto;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  }
  input, textarea, select, button {
    width: 100%;
    margin-bottom: 10px;
    padding: 8px;
    font-size: 1rem;
  }
  button {
    background: #28a745;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:disabled {
    background: #ccc;
  }
  .progress-container {
    display: none;
    margin-bottom: 10px;
  }
  .progress-bar {
    width: 0;
    height: 8px;
    background: #007bff;
  }
</style>
</head>
<body>

<h1>Admin Panel - Add Product</h1>

<form id="productForm">
  <input type="text" id="name" placeholder="Product Name" required>
  <textarea id="description" placeholder="Product Description"></textarea>
  <input type="number" id="price" placeholder="Price" step="0.01" required>
  <input type="text" id="category" placeholder="Category">
  <input type="file" id="image">
  
  <div class="progress-container" id="progressContainer">
    <div class="progress-bar" id="progressBar"></div>
  </div>
  
  <button type="submit" id="submitBtn">Add Product</button>
</form>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCcWgFDzs95TbVU7v5h_5O0lNzZvBlL90o",
  authDomain: "baganiza-66bf0.firebaseapp.com",
  projectId: "baganiza-66bf0",
  storageBucket: "baganiza-66bf0.appspot.com",
  messagingSenderId: "1016966032123",
  appId: "1:1016966032123:web:fbffd397c7d8494fa79e5e"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

const form = document.getElementById('productForm');
const progressContainer = document.getElementById('progressContainer');
const progressBar = document.getElementById('progressBar');
const submitBtn = document.getElementById('submitBtn');

form.addEventListener('submit', async (e) => {
  e.preventDefault();

  submitBtn.disabled = true;

  const name = document.getElementById('name').value.trim();
  const description = document.getElementById('description').value.trim();
  const price = parseFloat(document.getElementById('price').value);
  const category = document.getElementById('category').value.trim();
  const file = document.getElementById('image').files[0];

  const productData = { name, description, price, category };

  if (file) {
    try {
      progressContainer.style.display = 'block';
      const storageRef = storage.ref('product-images/' + Date.now() + '-' + file.name);
      const uploadTask = storageRef.put(file);

      uploadTask.on('state_changed',
        (snapshot) => {
          const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
          progressBar.style.width = progress + '%';
        },
        (error) => {
          console.error('Upload failed:', error);
          addProductToDB(productData); // بدون صورة
        },
        async () => {
          const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
          productData.imageUrl = downloadURL;
          addProductToDB(productData);
        }
      );
    } catch (err) {
      console.error(err);
      addProductToDB(productData); // بدون صورة
    }
  } else {
    addProductToDB(productData); // بدون صورة
  }
});

function addProductToDB(data) {
  db.collection('products').add(data)
    .then(() => {
      alert('Product added successfully!');
      form.reset();
      progressContainer.style.display = 'none';
      progressBar.style.width = '0%';
      submitBtn.disabled = false;
    })
    .catch(err => {
      console.error('Error adding product:', err);
      alert('Error adding product.');
      submitBtn.disabled = false;
    });
}
</script>

</body>
</html>
