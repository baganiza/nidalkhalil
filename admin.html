<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>لوحة إدارة المنتجات</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #f8f4f0;
    margin: 0;
    padding: 20px;
  }
  h1 {
    color: #ff6f61;
  }
  label {
    display: block;
    margin-top: 10px;
  }
  input, textarea, button {
    width: 100%;
    padding: 8px;
    margin-top: 5px;
    border-radius: 5px;
    border: 1px solid #ccc;
  }
  button {
    background: #ff6f61;
    color: white;
    border: none;
    cursor: pointer;
    margin-top: 15px;
  }
  progress {
    width: 100%;
    height: 20px;
    margin-top: 10px;
  }
</style>
</head>
<body>

<h1>إضافة منتج جديد</h1>
<label>اسم المنتج</label>
<input type="text" id="productName">

<label>الوصف</label>
<textarea id="productDesc"></textarea>

<label>السعر</label>
<input type="number" id="productPrice">

<label>صورة المنتج (اختياري)</label>
<input type="file" id="productImage" accept="image/*">

<progress id="uploadProgress" value="0" max="100" style="display:none;"></progress>

<button id="addProductBtn">إضافة المنتج</button>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_BUCKET",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();

  const addProductBtn = document.getElementById('addProductBtn');
  const uploadProgress = document.getElementById('uploadProgress');

  addProductBtn.onclick = () => {
    const name = document.getElementById('productName').value.trim();
    const desc = document.getElementById('productDesc').value.trim();
    const price = parseFloat(document.getElementById('productPrice').value);
    const file = document.getElementById('productImage').files[0];

    if (!name || !desc || isNaN(price)) {
      alert('يرجى إدخال جميع البيانات المطلوبة');
      return;
    }

    if (file) {
      const storageRef = storage.ref('products/' + Date.now() + '_' + file.name);
      const uploadTask = storageRef.put(file);

      uploadProgress.style.display = 'block';

      uploadTask.on('state_changed',
        (snapshot) => {
          const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
          uploadProgress.value = progress;
        },
        (error) => {
          console.error('فشل رفع الصورة:', error);
          saveProduct(name, desc, price, null);
        },
        () => {
          uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
            saveProduct(name, desc, price, downloadURL);
          });
        }
      );

    } else {
      saveProduct(name, desc, price, null);
    }
  };

  function saveProduct(name, desc, price, imageUrl) {
    db.collection('products').add({
      name: name,
      description: desc,
      price: price,
      imageUrl: imageUrl || ''
    }).then(() => {
      alert('تمت إضافة المنتج بنجاح');
      location.reload();
    }).catch((err) => {
      console.error('خطأ في إضافة المنتج:', err);
    });
  }
</script>
</body>
</html>
