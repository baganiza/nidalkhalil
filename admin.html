<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin Panel - Manage Products</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  button { padding: 5px 10px; margin: 2px; }
  #login-form, #logout-btn { margin-bottom: 20px; }
  #product-form { margin-top: 20px; }
</style>
</head>
<body>

<h1>Admin Panel - Manage Products</h1>

<!-- Login Form -->
<div id="login-form">
  <h3>Login</h3>
  <input type="email" id="email" placeholder="Email" /><br /><br />
  <input type="password" id="password" placeholder="Password" /><br /><br />
  <button id="login-btn">Login</button>
  <p id="login-msg" style="color:red;"></p>
</div>

<!-- Logout Button -->
<div id="logout-btn" style="display:none;">
  <button id="logout">Logout</button>
</div>

<!-- Products Table -->
<div id="admin-content" style="display:none;">
  <h3>Current Products</h3>
  <table>
    <thead>
      <tr><th>ID</th><th>Name</th><th>Price</th><th>Description</th><th>Actions</th></tr>
    </thead>
    <tbody id="products-table"></tbody>
  </table>

  <h3>Add / Edit Product</h3>
  <form id="product-form">
    <input type="hidden" id="product-id" />
    <input type="text" id="product-name" placeholder="Name" required />
    <input type="number" id="product-price" placeholder="Price" required min="0" />
    <input type="text" id="product-desc" placeholder="Description" required />
    <button type="submit">Save Product</button>
    <button type="button" id="cancel-edit" style="display:none;">Cancel Edit</button>
  </form>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  // TODO: استبدل البيانات هنا ببيانات مشروع Firebase الخاص بك
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const loginForm = document.getElementById('login-form');
  const loginBtn = document.getElementById('login-btn');
  const loginMsg = document.getElementById('login-msg');
  const logoutBtn = document.getElementById('logout-btn');
  const logout = document.getElementById('logout');
  const adminContent = document.getElementById('admin-content');

  const productsTable = document.getElementById('products-table');
  const productForm = document.getElementById('product-form');
  const productIdInput = document.getElementById('product-id');
  const productNameInput = document.getElementById('product-name');
  const productPriceInput = document.getElementById('product-price');
  const productDescInput = document.getElementById('product-desc');
  const cancelEditBtn = document.getElementById('cancel-edit');

  // تابع تحديث عرض المنتجات من Firestore
  function loadProducts() {
    productsTable.innerHTML = "";
    db.collection("products").orderBy("name").get()
      .then(snapshot => {
        snapshot.forEach(doc => {
          const p = doc.data();
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${doc.id}</td>
            <td>${p.name}</td>
            <td>${p.price}</td>
            <td>${p.description}</td>
            <td>
              <button onclick="editProduct('${doc.id}', '${escapeHtml(p.name)}', ${p.price}, '${escapeHtml(p.description)}')">Edit</button>
              <button onclick="deleteProduct('${doc.id}')">Delete</button>
            </td>
          `;
          productsTable.appendChild(row);
        });
      })
      .catch(e => console.error("Error loading products:", e));
  }

  // دالة لحماية النصوص (لتجنب مشاكل في HTML)
  function escapeHtml(text) {
    return text.replace(/&/g, "&amp;").replace(/"/g, "&quot;").replace(/'/g, "&#39;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
  }

  // تفعيل زر التعديل
  function editProduct(id, name, price, description) {
    productIdInput.value = id;
    productNameInput.value = name;
    productPriceInput.value = price;
    productDescInput.value = description;
    cancelEditBtn.style.display = "inline";
  }

  // حذف المنتج
  function deleteProduct(id) {
    if (confirm("Are you sure to delete this product?")) {
      db.collection("products").doc(id).delete()
      .then(() => loadProducts())
      .catch(e => alert("Failed to delete: " + e));
    }
  }

  // إلغاء التعديل
  cancelEditBtn.addEventListener('click', () => {
    productIdInput.value = "";
    productForm.reset();
    cancelEditBtn.style.display = "none";
  });

  // حفظ المنتج (إضافة أو تحديث)
  productForm.addEventListener('submit', e => {
    e.preventDefault();
    const id = productIdInput.value.trim();
    const name = productNameInput.value.trim();
    const price = parseFloat(productPriceInput.value);
    const description = productDescInput.value.trim();

    if (!name || isNaN(price) || !description) {
      alert("Please fill all fields correctly.");
      return;
    }

    if (id) {
      // تحديث
      db.collection("products").doc(id).set({ name, price, description })
      .then(() => {
        loadProducts();
        productForm.reset();
        productIdInput.value = "";
        cancelEditBtn.style.display = "none";
      })
      .catch(e => alert("Update failed: " + e));
    } else {
      // إضافة جديد (مع Auto-ID)
      db.collection("products").add({ name, price, description })
      .then(() => {
        loadProducts();
        productForm.reset();
      })
      .catch(e => alert("Add failed: " + e));
    }
  });

  // تسجيل الدخول
  loginBtn.addEventListener('click', () => {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value.trim();
    loginMsg.textContent = "";
    if (!email || !password) {
      loginMsg.textContent = "Please enter email and password";
      return;
    }
    auth.signInWithEmailAndPassword(email, password)
      .catch(err => loginMsg.textContent = err.message);
  });

  // تسجيل الخروج
  logout.addEventListener('click', () => {
    auth.signOut();
  });

  // حالة المستخدم (مراقبة تسجيل الدخول)
  auth.onAuthStateChanged(user => {
    if (user) {
      loginForm.style.display = "none";
      logoutBtn.style.display = "block";
      adminContent.style.display = "block";
      loadProducts();
    } else {
      loginForm.style.display = "block";
      logoutBtn.style.display = "none";
      adminContent.style.display = "none";
    }
  });
</script>
</body>
</html>
